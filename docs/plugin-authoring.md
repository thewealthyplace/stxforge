# Writing a stxforge Plugin

This guide explains how to create, publish, and use a community plugin for stxforge.

## Quick Start

```bash
mkdir stxforge-plugin-my-template
cd stxforge-plugin-my-template
npm init
```

## Plugin Package Structure

```
stxforge-plugin-my-template/
├── package.json          # declares stxforge.plugin = true
├── index.js              # plugin entry point
├── templates/
│   └── my-template/
│       ├── schema.json           # input prompt definition
│       ├── contract.clar.hbs     # Handlebars contract template
│       └── test.ts.hbs           # optional test template
└── README.md
```

## package.json Requirements

```json
{
  "name": "stxforge-plugin-my-template",
  "version": "1.0.0",
  "stxforge": {
    "plugin": true,
    "verified": false,
    "templates": ["my-template"]
  }
}
```

- Name **must** start with `stxforge-plugin-`
- `stxforge.plugin` **must** be `true`
- `stxforge.templates` lists template directory names

## schema.json Format

```json
{
  "name": "my-template",
  "description": "What this template generates",
  "prompts": [
    {
      "name": "tokenName",
      "type": "input",
      "message": "Token name:"
    },
    {
      "name": "decimals",
      "type": "number",
      "message": "Decimals:",
      "default": 6
    },
    {
      "name": "mintable",
      "type": "confirm",
      "message": "Enable minting?",
      "default": false
    }
  ]
}
```

## Handlebars Templates

Use `{{variableName}}` to inject prompt answers into your `.clar.hbs` file:

```clarity
;; {{tokenName}} Contract
;; Generated by stxforge-plugin-my-template

(define-fungible-token {{contractName}})

(define-constant DECIMALS u{{decimals}})

{{#if mintable}}
(define-public (mint (amount uint) (recipient principal))
  (begin
    (asserts! (is-eq tx-sender CONTRACT-OWNER) (err u100))
    (ft-mint? {{contractName}} amount recipient)))
{{/if}}
```

Available context variables:
- All prompt `name` fields as-is
- `contractName` — auto-generated from `name` (lowercased, hyphenated)

## Trust Model

| Badge | Meaning |
|-------|---------|
| `[verified]` | Published by the stxforge core team or audited partners |
| `[community]` | Published by the community — review before using |

To request verified status, open a PR in the stxforge GitHub org.

## Publishing

```bash
npm publish --access public
```

Users install via:

```bash
stxforge plugin install my-template
# or
stxforge plugin install stxforge-plugin-my-template
```

## Security Guidelines

- Never access the filesystem outside the project directory
- Do not make network requests from templates
- Do not `require` arbitrary user-supplied modules
- All prompts should have sensible defaults
